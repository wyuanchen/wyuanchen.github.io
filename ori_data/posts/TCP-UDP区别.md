---
title: 'TCP,UDP区别'
date: 2016-03-15 22:10:30
categories: 网络协议
tags:
- TCP
- UDP
---

- UDP协议是**无面向连接**的、**不可靠**的、**无序**的、**无流量控制**的传输层协议，UDP发送的每个数据报是记录型的数据报，所谓的记录型数据报就是接收进程可以识别接收到的数据报的记录边界。  
- TCP协议是**面向连接**的、**可靠的**、**有序的**、**拥有流量控制**的传输层协议，它是字节流的协议，无记录边界。  
- 校验和   
    - UDP对首部和数据部分都进行校验，而IP首部的校验和仅对IP的首部进行校验  
    - TCP的校验和也是对首部和数据部分都进行校验   
    - UDP的校验和是可选的，而TCP的是必选的。    

<!-- more -->

![](http://img.my.csdn.net/uploads/201303/15/1363304832_2419.jpg)   

## 什么是面向字节流、面向报文？  

### 面向字节流  

虽然应用程序和TCP的交互是一次一个数据块（大小不等），但TCP把应用程序看成是一连串的无结构的字节流。TCP有一个缓冲，当应用程序传送的数据块太长，TCP就可以把它划分短一些再传送。如果应用程序一次只发送一个字节，TCP也可以等待积累有足够多的字节后再构成报文段发送出去。   

### 面向报文   

面向报文的传输方式是应用层交给UDP多长的报文，UDP就照样发送，即一次发送一个报文。因此，应用程序必须选择合适大小的报文。若报文太长，则IP层需要分片，降低效率。若太短，会是IP太小。（谢希仁，第五版。UDP对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边界。这也就是说，应用层交给UDP多长的报文，UDP就照样发送），即一次发送一个报文）。      

### 在默认的阻塞模式下，为什么说TCP无边界，UDP有边界？   

-  对于TCP协议，客户端连续发送数据，只要服务端的这个函数的缓冲区足够大，会一次性接收过来，即客户端是分好几次发过来，是有边界的，而服务端却一次性接收过来，所以证明是无边界的；   
- 而对于UDP协议，客户端连续发送数据，即使服务端的这个函数的缓冲区足够大，也只会一次一次的接收，发送多少次接收多少次，即客户端分几次发送过来，服务端就必须按几次接收，从而证明，这种UDP的通讯模式是有边界的。  

### 有分片的情况下如下处理    

>如果MTU是1500，使用UDP发送 2000，那么recvfrom(2000)是收到1500，还是2000?   

还是接收2000，数据分片由ip层处理了，放到udp还是一个完整的包。接收到的包是由路由路径上最少的MTU来分片，注意转到UDP已经在是组装好的(组装出错的包会经crc校验出错而丢弃)，是一个完整的数据包。  

>如果500那个片丢了怎么办？udp又没有重传   

udp里有个crc检验，如果包不完整就会丢弃，也不会通知是否接收成功，所以UDP是不可靠的传输协议，而且TCP不存在这个问题，有自己的重传机制。在内网来说，UDP基本不会有丢包，可靠性还是有保障。当然如果是要求有时序性和高可靠性，还是走TCP，不然就要自己提供重传和乱序处理( UDP内网发包处理量可以达 7M~10M/s )   


