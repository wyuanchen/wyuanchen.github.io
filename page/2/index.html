<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>wYuan&#39;s Blog</title>
	<link rel="stylesheet" href="/css/style.css" />
	
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/archives" class="header__link">Archive</a>
			
				<a href="/tags" class="header__link">Tags</a>
			
				<a href="/categories" class="header__link">Categories</a>
			
		</nav>
		<h1 class="header__title"><a href="/">wYuan&#39;s Blog</a></h1>
		<h2 class="header__subtitle">Enjoy the world</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2017/01/28/åœ¨éå†Listçš„è¿‡ç¨‹ä¸­åˆ é™¤å…ƒç´ /">åœ¨éå†Listçš„è¿‡ç¨‹ä¸­åˆ é™¤å…ƒç´ </a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Java/">Java</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Java/">Java</a>
			</span>
		
	</div>

	

	
		<h3 id="é¦–å…ˆéå†Listçš„æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§"><a href="#é¦–å…ˆéå†Listçš„æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§" class="headerlink" title="é¦–å…ˆéå†Listçš„æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§:"></a>é¦–å…ˆéå†Listçš„æ–¹å¼æœ‰ä»¥ä¸‹å‡ ç§:</h3><ul>
<li>æ™®é€šforå¾ªç¯</li>
<li>foreachå¾ªç¯</li>
<li>ä½¿ç”¨è¿­ä»£å™¨(Iterator)</li>
</ul>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * ä½¿ç”¨foeachå¾ªç¯ </div><div class="line">     * åœ¨å¾ªç¯è¿‡ç¨‹ä¸­ä»Listä¸­åˆ é™¤å…ƒç´ ä»¥åï¼Œç»§ç»­å¾ªç¯Listæ—¶ä¼šæŠ›å‡º</div><div class="line">     * ConcurrentModificationException </div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">listRemove</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;Handler&gt; handlers = <span class="keyword">this</span>.handlers();</div><div class="line">        <span class="keyword">for</span> (Handler <span class="keyword">handler</span> : handlers) &#123;</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">handler</span>.getId() == <span class="number">2</span>)</div><div class="line">                handlers.remove(<span class="keyword">handler</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** </span></div><div class="line"> * åƒè¿™ç§foreachå¾ªç¯+breakæ“ä½œå¯¹Listè¿›è¡Œéå†åˆ é™¤ï¼Œä½†åˆ é™¤ä¹‹åé©¬ä¸Šå°±è·³å‡ºçš„ä¹Ÿ</div><div class="line"> * ä¸ä¼šå‡ºç°å¼‚å¸¸ </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">listRemoveBreak</span><span class="params">()</span> </span>&#123;  </div><div class="line">    List&lt;Handler&gt; handlers = <span class="keyword">this</span>.Handlers();  </div><div class="line">    <span class="keyword">for</span> (Handler <span class="keyword">handler</span> : handlers) &#123;  </div><div class="line">        <span class="keyword">if</span> (<span class="keyword">handler</span>.getId() == <span class="number">2</span>) &#123;  </div><div class="line">            handlers.remove(<span class="keyword">handler</span>);  </div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** </span></div><div class="line"> * è¿™ç§éå†æœ‰å¯èƒ½ä¼šé—æ¼æŸä¸ªå…ƒç´ ,å› ä¸ºåˆ é™¤å…ƒç´ åListçš„sizeåœ¨ </div><div class="line"> * å˜åŒ–ï¼Œå…ƒç´ çš„ç´¢å¼•ä¹Ÿåœ¨å˜åŒ–ï¼Œæ¯”å¦‚ä½ å¾ªç¯åˆ°ç¬¬2ä¸ªå…ƒç´ çš„æ—¶å€™ä½ æŠŠå®ƒåˆ äº†ï¼Œ </div><div class="line"> * æ¥ä¸‹æ¥ä½ å»è®¿é—®ç¬¬3ä¸ªå…ƒç´ ï¼Œå®é™…ä¸Šè®¿é—®åˆ°çš„æ˜¯åŸå…ˆçš„ç¬¬4ä¸ªå…ƒç´ ã€‚å½“è®¿é—®çš„å…ƒ</div><div class="line"> * ç´  </div><div class="line"> * ç´¢å¼•è¶…è¿‡äº†å½“å‰çš„Listçš„sizeåè¿˜ä¼šå‡ºç°æ•°ç»„è¶Šç•Œçš„å¼‚å¸¸ï¼Œå½“ç„¶è¿™é‡Œä¸ä¼šå‡ºç°</div><div class="line"> * è¿™ç§å¼‚å¸¸ï¼Œ </div><div class="line"> * å› ä¸ºè¿™é‡Œæ¯éå†ä¸€æ¬¡éƒ½é‡æ–°æ‹¿äº†ä¸€æ¬¡å½“å‰Listçš„sizeã€‚ </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> listRemove2() &#123;  </div><div class="line">    List&lt;handlers&gt; handlers = <span class="keyword">this</span>.getHandlers();  </div><div class="line">    <span class="built_in">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;handlers.<span class="built_in">size</span>(); i++) &#123;  </div><div class="line">        <span class="built_in">if</span> (handlers.<span class="built_in">get</span>(i).getId() == <span class="number">1</span>) &#123;  </div><div class="line">            Handler handler = handlers.<span class="built_in">get</span>(i);  </div><div class="line">            handlers.<span class="built_in">remove</span>(handler);  </div><div class="line">        &#125;  </div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** </span></div><div class="line"> * ä½¿ç”¨Iteratorçš„æ–¹å¼ä¹Ÿå¯ä»¥é¡ºåˆ©åˆ é™¤å’Œéå† </div><div class="line"> */  </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">iteratorRemove</span>(<span class="params"></span>) </span>&#123;  </div><div class="line">    List&lt;Handlers&gt; handlers = <span class="keyword">this</span>.getHandlers();  </div><div class="line">    System.<span class="keyword">out</span>.println(handlers);  </div><div class="line">    Iterator&lt;Handler&gt; handlIter = handlers.iterator();  </div><div class="line">    <span class="keyword">while</span> (handlIter.hasNext()) &#123;  </div><div class="line">        Handler handler = handlIter.next();  </div><div class="line">        <span class="keyword">if</span> (handler.getId()  == <span class="number">1</span>)  </div><div class="line">            handlIter.<span class="keyword">remove</span>();<span class="comment">//è¿™é‡Œè¦ä½¿ç”¨Iteratorçš„removeæ–¹æ³•ç§»é™¤å½“å‰å¯¹è±¡ï¼Œå¦‚æœä½¿ç”¨Listçš„removeæ–¹æ³•ï¼Œåˆ™åŒæ ·ä¼šå‡ºç°ConcurrentModificationException  </span></div><div class="line">    &#125;  </div><div class="line">    System.<span class="keyword">out</span>.println(handlers);  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="å¦‚æœæ˜¯åœ¨éå†æ“ä½œè¿œå¤šäºå¯å˜æ“ä½œçš„æ—¶å€™ï¼Œè¿˜å¯ä»¥å¯ä»¥è€ƒè™‘CopyOnWriteArrayList"><a href="#å¦‚æœæ˜¯åœ¨éå†æ“ä½œè¿œå¤šäºå¯å˜æ“ä½œçš„æ—¶å€™ï¼Œè¿˜å¯ä»¥å¯ä»¥è€ƒè™‘CopyOnWriteArrayList" class="headerlink" title="å¦‚æœæ˜¯åœ¨éå†æ“ä½œè¿œå¤šäºå¯å˜æ“ä½œçš„æ—¶å€™ï¼Œè¿˜å¯ä»¥å¯ä»¥è€ƒè™‘CopyOnWriteArrayList"></a>å¦‚æœæ˜¯åœ¨éå†æ“ä½œè¿œå¤šäºå¯å˜æ“ä½œçš„æ—¶å€™ï¼Œè¿˜å¯ä»¥å¯ä»¥è€ƒè™‘CopyOnWriteArrayList</h3><pre><code>è¿™ä¸€èˆ¬éœ€è¦å¾ˆå¤§çš„å¼€é”€ï¼Œä½†æ˜¯å½“éå†æ“ä½œçš„æ•°é‡å¤§å¤§è¶…è¿‡å¯å˜æ“ä½œçš„æ•°é‡æ—¶ï¼Œè¿™ç§æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–æ›¿ä»£æ–¹æ³•æ›´ æœ‰æ•ˆã€‚åœ¨ä¸èƒ½æˆ–ä¸æƒ³è¿›è¡ŒåŒæ­¥éå†ï¼Œä½†åˆéœ€è¦ä»å¹¶å‘çº¿ç¨‹ä¸­æ’é™¤å†²çªæ—¶ï¼Œå®ƒä¹Ÿå¾ˆæœ‰ç”¨ã€‚â€œå¿«ç…§â€é£æ ¼çš„è¿­ä»£å™¨æ–¹æ³•åœ¨åˆ›å»ºè¿­ä»£å™¨æ—¶ä½¿ç”¨äº†å¯¹æ•°ç»„çŠ¶æ€çš„å¼•ç”¨ã€‚æ­¤æ•°ç»„åœ¨è¿­ä»£å™¨çš„ç”Ÿå­˜æœŸå†…ä¸ä¼šæ›´æ”¹ï¼Œå› æ­¤ä¸å¯èƒ½å‘ç”Ÿå†²çªï¼Œå¹¶ä¸”è¿­ä»£å™¨ä¿è¯ä¸ä¼šæŠ›å‡ºConcurrentModificationExceptionã€‚åˆ›å»ºè¿­ä»£å™¨ä»¥åï¼Œè¿­ä»£å™¨å°±ä¸ä¼šåæ˜ åˆ—è¡¨çš„æ·»åŠ ã€ç§»é™¤æˆ–è€…æ›´æ”¹ã€‚åœ¨è¿­ä»£å™¨ä¸Šè¿›è¡Œçš„å…ƒç´ æ›´æ”¹æ“ä½œï¼ˆremoveã€setå’Œaddï¼‰ä¸å—æ”¯æŒã€‚è¿™äº›æ–¹æ³•å°†æŠ›å‡ºUnsupportedOperationExceptionã€‚å…è®¸ä½¿ç”¨æ‰€æœ‰å…ƒç´ ï¼ŒåŒ…æ‹¬nullã€‚
</code></pre>
	

	

</article>




	<article>
	
		<h1><a href="/2017/01/28/pandas-å¸¸ç”¨æ“ä½œ/">pandas å¸¸ç”¨æ“ä½œ</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/æ•°æ®å¤„ç†/">æ•°æ®å¤„ç†</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Pandas/">Pandas</a>
			</span>
		
	</div>

	

	
		<p>###åˆ é™¤æ“ä½œ</p>
<ul>
<li>åˆ é™¤åˆ—ï¼š<br><code>df=df.drop(&#39;column_label&#39;,axis=1)</code></li>
<li>åˆ é™¤è¡Œï¼š<br><code>df=df.drop(&#39;row_label&#39;)</code></li>
<li>åˆ é™¤é‡å¤çš„è¡Œ: <code>df=df.drop_duplicates([&#39;column_label_one&#39;,&#39;column_label_two&#39;])</code></li>
</ul>
<h3 id="æŸ¥çœ‹"><a href="#æŸ¥çœ‹" class="headerlink" title="æŸ¥çœ‹"></a>æŸ¥çœ‹</h3><ul>
<li>æŸ¥çœ‹è¡Œæ•°<br><code>len(df) or len(df.index) or df.shape[0]</code></li>
<li>åˆ—æ•°<br><code>len(df.columns) or df.shape[1]</code></li>
<li>æ•°æ®ç±»å‹<br><code>df.dtypes</code></li>
</ul>
<p>###é‡å‘½å</p>
<ul>
<li>åˆ—æ ‡ç­¾çš„é‡å‘½å<br><code>df.rename(columns={&quot;old label&quot;: &quot;new label&quot;})â€‹</code></li>
<li>è¡Œæ ‡ç­¾çš„é‡å‘½å<br><code>df.rename(index={&quot;old label&quot;: &quot;new label&quot;}â€‹</code></li>
</ul>
<h3 id="æ—¶é—´åºåˆ—çš„æ“ä½œ"><a href="#æ—¶é—´åºåˆ—çš„æ“ä½œ" class="headerlink" title="æ—¶é—´åºåˆ—çš„æ“ä½œ"></a>æ—¶é—´åºåˆ—çš„æ“ä½œ</h3><ul>
<li>å°†æ—¶é—´å­—ç¬¦ä¸²è½¬æ¢æˆdatetimeæ•°æ®<br><code>dt[&#39;StartTime&#39;] = pd.to_datetime(dt[&#39;StartTime&#39;])</code></li>
</ul>
<p>###æ’åº</p>
<ul>
<li>æŒ‰å€¼æ’åºï¼Œå¯æŒ‡å®šåˆ—åå’Œæ’åºæ–¹å¼ï¼Œé»˜è®¤çš„æ˜¯å‡åºæ’åº<br><code>dt.sort([&#39;StartTime&#39;], inplace=True) or dt.sort([&#39;StartTime&#39;])</code> </li>
<li>ç…§ç´¢å¼•ï¼ˆè¡Œåï¼‰æˆ–è€…åˆ—åè¿›è¡Œæ’åº,æŒ‡å®šaxis=0è¡¨ç¤ºæŒ‰ç´¢å¼•ï¼ˆè¡Œåï¼‰æ’åºï¼Œaxis=1è¡¨ç¤ºæŒ‰åˆ—åæ’åºï¼Œå¹¶å¯æŒ‡å®šå‡åºæˆ–è€…é™åºï¼š<br><code>df.sort_index(axis=1, ascending=False)</code></li>
</ul>
<p>###è¯»å†™æ“ä½œ</p>
<ul>
<li><p>è¯»csv<br><code>pd.read_csv(&#39;input.csv&#39;) | pd.read_table(&#39;input.csv&#39;, sep=&#39;,&#39;)</code></p>
<ul>
<li>å‚æ•° header = None pandasåˆ†é…é»˜è®¤åˆ—å</li>
<li>å‚æ•° name = [â€˜aâ€™, â€˜bâ€™, â€˜câ€™] æŒ‡å®šåˆ—å</li>
<li>å‚æ•° index_col=â€™idx æŒ‡å®šç´¢å¼•</li>
<li>å‚æ•° shiprows = [0, 2, 4] è·³è¿‡æ–‡ä»¶éƒ¨åˆ†è¡Œ</li>
<li>å‚æ•° nrows = 20 åªè¯»å–æ–‡ä»¶å‰xxè¡Œ</li>
<li>å‚æ•° chunksize = 10000 æŒ‡å®šæ¯æ¬¡è¯»å–è¡Œæ•°ï¼Œåˆ†å—è¯»å–ï¼Œè¿”å›TextParseå¯¹è±¡</li>
</ul>
</li>
<li><p>å†™csv<br><code>pd.to_csv(&#39;output.csv&#39;)</code></p>
<ul>
<li>å‚æ•° na_rep = â€˜NULLâ€™ ç¼ºå¤±å€¼è¾“å‡ºä¸ºæŒ‡å®šæ ‡è®°å€¼ï¼Œé»˜è®¤ä¸ºç©ºå­—ç¬¦ä¸²</li>
<li>å‚æ•° index = False, header = False ç¦æ­¢è¾“å‡ºè¡Œå’Œåˆ—çš„æ ‡ç­¾, é»˜è®¤è¾“å‡º</li>
<li>å‚æ•° cols=[â€˜aâ€™, â€˜bâ€™] æŒ‡å®šè¾“å‡ºä»¥éƒ¨åˆ†åˆ—ï¼Œå¹¶ä»¥æŒ‡å®šé¡ºåºæ’åº</li>
</ul>
</li>
</ul>

	

	

</article>




	<article>
	
		<h1><a href="/2017/01/28/mysqlæ“ä½œç¬”è®°/">mysqlæ“ä½œç¬”è®°</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/æ•°æ®åº“/">æ•°æ®åº“</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Mysql/">Mysql</a>
			</span>
		
	</div>

	

	
		<p><a href="http://www.cnblogs.com/xuejie/archive/2013/01/11/2856911.html" target="_blank" rel="external">ä¼ é€é—¨</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2017/01/28/CentOS-7-å®‰è£…-Tomcat/">CentOS 7 å®‰è£… Tomcat</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/åå°/">åå°</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Tomcat/">Tomcat</a>
			</span>
		
	</div>

	

	
		<p><a href="https://yq.aliyun.com/articles/47252" target="_blank" rel="external">ä¼ é€é—¨</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2017/01/28/javaè¯»å–é…ç½®æ–‡ä»¶çš„å‡ ç§æ–¹å¼/">javaè¯»å–é…ç½®æ–‡ä»¶çš„å‡ ç§æ–¹å¼</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Java/">Java</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Java/">Java</a>
			</span>
		
	</div>

	

	
		<p>##1.ä½¿ç”¨ç»å¯¹è·¯å¾„(ä¸æ¨è,ç§»æ¤æ€§å·®)</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Configuration</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> picTempDirUrl;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> picStoreDir;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        Properties properties=<span class="keyword">new</span> <span class="type">Properties</span>();</div><div class="line">        InputStream <span class="keyword">in</span>=<span class="keyword">new</span> <span class="type">FileInputStream</span>(<span class="string">"/home/ubuntu/img/config.properties"</span>);<span class="comment">//é…ç½®æ–‡ä»¶åœ¨ç£ç›˜çš„ç»å¯¹è·¯å¾„</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            properties.load(<span class="keyword">in</span>);</div><div class="line">            <span class="keyword">in</span>.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        picTempDirUrl= (<span class="keyword">String</span>) properties.<span class="keyword">get</span>(<span class="string">"picTempDirUrl"</span>);</div><div class="line">        picStoreDir= (<span class="keyword">String</span>) properties.<span class="keyword">get</span>(<span class="string">"picStoreDir"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##2.ä½¿ç”¨getResourceAsStream</p>
<p>###Class.getResourceAsStream(String path) ï¼š</p>
<blockquote>
<p>è·¯å¾„åä¸ä»¥â€™/â€˜å¼€å¤´æ—¶é»˜è®¤æ˜¯ä»æ­¤ç±»æ‰€åœ¨çš„åŒ…ä¸‹å–èµ„æºï¼Œä»¥â€™/â€˜å¼€å¤´åˆ™æ˜¯ä»ClassPathæ ¹ä¸‹è·å–ã€‚å…¶åªæ˜¯é€šè¿‡pathæ„é€ ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œæœ€ç»ˆè¿˜æ˜¯ç”±ClassLoaderè·å–èµ„æºã€‚</p>
</blockquote>
<p>###Class.getClassLoader.getResourceAsStream(String path) </p>
<blockquote>
<p>é»˜è®¤åˆ™æ˜¯ä»ClassPathæ ¹ä¸‹è·å–ï¼Œç»è¿‡æµ‹è¯•æ— è®ºpathæ˜¯ä¸æ˜¯ä»¥â€™/â€˜å¼€å¤´ï¼Œéƒ½æ˜¯ä»ClassPathæ ¹ä¸‹å¼€å§‹æ“ä½œï¼Œæœ€ç»ˆæ˜¯ç”±ClassLoaderè·å–èµ„æºã€‚</p>
</blockquote>
<p><strong>ä»¥ä¸‹æ˜¯ç”¨Class.getClassLoader.getResourceAsStream(String path)è·å–é…ç½®æ–‡ä»¶çš„ä¸€ä¸ªä¾‹å­</strong><br><figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Configuration</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> picTempDirUrl;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">String</span> picStoreDir;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        Properties properties=<span class="keyword">new</span> <span class="type">Properties</span>();</div><div class="line">        InputStream <span class="keyword">in</span>=Configuration.class.getClassLoader().getResourceAsStream(<span class="string">"config.properties"</span>);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            properties.load(<span class="keyword">in</span>);</div><div class="line">            <span class="keyword">in</span>.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        picTempDirUrl= (<span class="keyword">String</span>) properties.<span class="keyword">get</span>(<span class="string">"picTempDirUrl"</span>);</div><div class="line">        picStoreDir= (<span class="keyword">String</span>) properties.<span class="keyword">get</span>(<span class="string">"picStoreDir"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>é…ç½®æ–‡ä»¶å¯ä»¥æ”¾åœ¨srcç›®å½•é‡Œæˆ–è€…resourceç›®å½•é‡Œ</strong></p>
<p>##3.ServletContext.getResourceAsStream() </p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Properties <span class="built_in">properties</span> = <span class="built_in">new</span> Properties();</div><div class="line"><span class="built_in">properties</span>.<span class="built_in">load</span>(getServletContext().getResourceAsStream(<span class="string">"/WEB-INF/filename.properties"</span>));</div></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2017/01/28/java-åŠ¨æ€ä»£ç†å­¦ä¹ ç¬”è®°/">java-åŠ¨æ€ä»£ç†å­¦ä¹ ç¬”è®°</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/Java/">Java</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Java/">Java</a>
			</span>
		
	</div>

	

	
		<p><strong>ä»£ç†æ¨¡å¼</strong><br>    ç»™æŸä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹äºåŸå¯¹è±¡çš„è®¿é—®ï¼Œå³å®¢æˆ·ä¸ç›´æ¥æ“æ§åŸå¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†å¯¹è±¡é—´æ¥åœ°æ“æ§åŸå¯¹è±¡ã€‚<br><strong>å…¶ä¸­ä»£ç†å¯ä»¥åˆ†ä¸ºä¸¤ç§æ–¹å¼,åˆ†åˆ«æ˜¯é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†</strong>   </p>
		<p><a class="article__read-more-link" href="/2017/01/28/java-åŠ¨æ€ä»£ç†å­¦ä¹ ç¬”è®°/">...read more</a></p>
	

	

</article>




	<article>
	
		<h1><a href="/2017/01/28/Mybatis-if-åˆ¤æ–­çš„å‘/">Mybatis &lt;if&gt; åˆ¤æ–­çš„å‘</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-28</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/æ•°æ®åº“/">æ•°æ®åº“</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/Mybatis/">Mybatis</a>
			</span>
		
	</div>

	

	
		<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">if</span> test=<span class="string">"type=='y'"</span>&gt;  </div><div class="line">    <span class="keyword">and</span> <span class="built_in">status</span> = <span class="number">0</span>   </div><div class="line">&lt;/<span class="keyword">if</span>&gt;</div></pre></td></tr></table></figure>
<p>å½“ä¼ å…¥çš„typeçš„å€¼ä¸ºyçš„æ—¶å€™ï¼Œifåˆ¤æ–­å†…çš„sqlä¹Ÿä¸ä¼šæ‰§è¡Œï¼ŒæŠ±ç€è¿™ä¸ªç–‘é—®å°±å»çœ‹äº†mybatisæ˜¯æ€ä¹ˆè§£æsqlçš„ã€‚ä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹mybatis çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<p><strong>DefaultSqlSession.class</strong></p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">select</span><span class="params">(String statement, Object parameter, RowBounds rowBounds, ResultHandler <span class="keyword">handler</span>)</span> </span>&#123;  </div><div class="line">    <span class="keyword">try</span> &#123;  </div><div class="line">      MappedStatement ms = configuration.getMappedStatement(statement);  </div><div class="line">      executor.query(ms, wrapCollection(parameter), rowBounds, <span class="keyword">handler</span>);  </div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;  </div><div class="line">      <span class="keyword">throw</span> ExceptionFactory.wrapException(<span class="string">"Error querying database.  Cause: "</span> + e, e);  </div><div class="line">    &#125; <span class="keyword">finally</span> &#123;  </div><div class="line">      ErrorContext.instance().reset();  </div><div class="line">    &#125;  </div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>åœ¨ <code>executor.query(ms, wrapCollection(parameter), rowBounds, handler);</code><br>æ‰§è¡Œåˆ°BaseExecutor.classæ‰§è¡Œå™¨ä¸­çš„queryæ–¹æ³• </p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public &lt;E&gt; List&lt;E&gt; query(MappedStatement ms, Object <span class="keyword">parameter</span>, RowBounds <span class="comment">rowBounds, ResultHandler resultHandler) throws SQLException &#123;</span>  </div><div class="line">    BoundSql <span class="comment">boundSql = ms.getBoundSql(parameter)</span>;  </div><div class="line">    CacheKey key = createCacheKey(ms, <span class="keyword">parameter</span>, rowBounds, boundSql);  </div><div class="line">    return query(ms, <span class="keyword">parameter</span>, rowBounds, resultHandler, key, boundSql);  </div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p>åœ¨<code>query</code>çš„æ–¹æ³•ä¸­çœ‹åˆ°<code>boundSql</code>ï¼Œæ˜¯é€šè¿‡ <code>ms.getBoundSql(parameter);</code>è·å–çš„ã€‚</p>
<p>å†ç‚¹è¿›å»å¯ä»¥çœ‹åˆ°<code>MappedStatement.class</code>ç±»ä¸­çš„<code>getBoundSql</code>æ–¹æ³• </p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">public BoundSql getBoundSql(Object parameterObject) &#123;  </div><div class="line">    BoundSql boundSql = sqlSource.getBoundSql(parameterObject);  </div><div class="line">    List&lt;ParameterMapping&gt; parameterMappings = boundSql.getParameterMappings();  </div><div class="line">   <span class="built_in"> if </span>(parameterMappings == null || parameterMappings.size() &lt;= 0) &#123;  </div><div class="line">      boundSql =<span class="built_in"> new </span>BoundSql(configuration, boundSql.getSql(), parameterMap.getParameterMappings(), parameterObject);  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">    //<span class="built_in"> check </span>for nested result maps in parameter mappings (issue <span class="comment">#30)  </span></div><div class="line">    for (ParameterMapping pm<span class="keyword"> :</span> boundSql.getParameterMappings()) &#123;  </div><div class="line">      String rmId = pm.getResultMapId();  </div><div class="line">     <span class="built_in"> if </span>(rmId != null) &#123;  </div><div class="line">        ResultMap rm = configuration.getResultMap(rmId);  </div><div class="line">       <span class="built_in"> if </span>(rm != null) &#123;  </div><div class="line">          hasNestedResultMaps |= rm.hasNestedResultMaps();  </div><div class="line">        &#125;  </div><div class="line">      &#125;  </div><div class="line">    &#125;  </div><div class="line">  </div><div class="line">   <span class="built_in"> return </span>boundSql;  </div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>çœ‹åˆ°å…¶ä¸­æœ‰<code>sqlSource.getBoundSql(parameterObject);</code> <code>sqlsource</code>æ˜¯ä¸€ä¸ªæ¥å£ã€‚<br>ç±»ä¸­<code>getBoundSql</code>æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œmybatis ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥ä¸ºæˆ‘ä»¬æ„å»ºsqlã€‚<code>BoundSql</code> å¯¹è±¡å…¶ä¸­ä¿å­˜äº†ç»è¿‡å‚æ•°è§£æï¼Œä»¥åŠåˆ¤æ–­è§£æå®Œæˆsqlè¯­å¥ã€‚æ¯”å¦‚<if> <code>&lt;choose&gt; &lt;when&gt;</code> éƒ½ä¼šåœ¨è¿™ä¸€å±‚å®Œæˆï¼Œå…·ä½“çš„å®Œæˆæ–¹æ³•å¾€ä¸‹çœ‹ï¼Œé‚£æœ€å¸¸ç”¨<code>sqlSource</code>çš„å®ç°ç±»æ˜¯<code>DynamicSqlSource.class</code> </if></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">public class DynamicSqlSource implements SqlSource &#123;  </div><div class="line">  </div><div class="line">  private Configuration configuration<span class="comment">;  </span></div><div class="line">  private SqlNode rootSqlNode<span class="comment">;  </span></div><div class="line">  </div><div class="line">  public DynamicSqlSource(Configuration configuration, SqlNode rootSqlNode) &#123;  </div><div class="line">    this.configuration = configuration<span class="comment">;  </span></div><div class="line">    this.rootSqlNode = rootSqlNode<span class="comment">;  </span></div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  public <span class="keyword">BoundSql </span>getBoundSql(Object parameterObject) &#123;  </div><div class="line">    DynamicContext <span class="built_in">context</span> = new DynamicContext(configuration, parameterObject)<span class="comment">;  </span></div><div class="line">    rootSqlNode.apply(<span class="built_in">context</span>)<span class="comment">;  </span></div><div class="line">    SqlSourceBuilder sqlSourceParser = new SqlSourceBuilder(configuration)<span class="comment">;  </span></div><div class="line">    Class&lt;?&gt; parameterType = parameterObject == null ? Object.class : parameterObject.getClass()<span class="comment">;  </span></div><div class="line">    SqlSource sqlSource = sqlSourceParser.parse(<span class="built_in">context</span>.getSql(), parameterType, <span class="built_in">context</span>.getBindings())<span class="comment">;  </span></div><div class="line">    <span class="keyword">BoundSql </span><span class="keyword">boundSql </span>= sqlSource.getBoundSql(parameterObject)<span class="comment">;  </span></div><div class="line">    for (Map.Entry&lt;String, Object&gt; entry : <span class="built_in">context</span>.getBindings().entrySet()) &#123;  </div><div class="line">      <span class="keyword">boundSql.setAdditionalParameter(entry.getKey(), </span>entry.getValue())<span class="comment">;  </span></div><div class="line">    &#125;  </div><div class="line">    return <span class="keyword">boundSql; </span> </div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æ ¸å¿ƒæ–¹æ³•æ˜¯è°ƒç”¨äº†<code>rootSqlNode.apply(context);</code> <code>rootSqlNode</code>æ˜¯ä¸€ä¸ªæ¥å£ .</p>
<p>å¯ä»¥çœ‹åˆ°ç±»ä¸­ <code>rootSqlNode.apply(context);</code> çš„æ–¹æ³•æ‰§è¡Œå°±æ˜¯ä¸€ä¸ªé€’å½’çš„è°ƒç”¨ï¼Œé€šè¿‡ä¸åŒçš„<br>å®ç°ç±»æ‰§è¡Œä¸åŒçš„æ ‡ç­¾ï¼Œæ¯ä¸€æ¬¡appllæ˜¯å®Œæˆäº†æˆ‘ä»¬<code>&lt;&gt;&lt;/&gt;</code>ä¸€æ¬¡æ ‡ç­¾ä¸­çš„sqlåˆ›å»ºï¼Œè®¡ç®—å‡ºæ ‡ç­¾ä¸­çš„é‚£ä¸€æ®µsqlï¼Œmybatisé€šè¿‡ä¸åœçš„é€’å½’è°ƒç”¨ï¼Œæ¥ä¸ºæˆ‘ä»¬å®Œæˆäº†æ•´ä¸ªsqlçš„æ‹¼æ¥ã€‚é‚£æˆ‘ä»¬ä¸»è¦æ¥çœ‹IFçš„å®ç°ç±»<code>IfSqlNode.class</code></p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IfSqlNode</span> <span class="keyword"><span class="keyword">implements</span> <span class="type">SqlNode</span></span> </span>&#123;  </div><div class="line">  <span class="keyword">private</span> ExpressionEvaluator evaluator;  </div><div class="line">  <span class="keyword">private</span> <span class="keyword">String</span> test;  </div><div class="line">  <span class="keyword">private</span> SqlNode contents;  </div><div class="line">  </div><div class="line">  <span class="keyword">public</span> IfSqlNode(SqlNode contents, <span class="keyword">String</span> test) &#123;  </div><div class="line">    <span class="built_in">this</span>.test = test;  </div><div class="line">    <span class="built_in">this</span>.contents = contents;  </div><div class="line">    <span class="built_in">this</span>.evaluator = <span class="keyword">new</span> <span class="type">ExpressionEvaluator</span>();  </div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">  <span class="keyword">public</span> boolean apply(DynamicContext context) &#123;  </div><div class="line">    <span class="keyword">if</span> (evaluator.evaluateBoolean(test, context.getBindings())) &#123;  </div><div class="line">      contents.apply(context);  </div><div class="line">      <span class="keyword">return</span> <span class="literal">true</span>;  </div><div class="line">    &#125;  </div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;  </div><div class="line">  &#125;  </div><div class="line">  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°IFçš„å®ç°ä¸­ï¼Œæ‰§è¡Œäº† if (evaluator.evaluateBoolean(test, context.getBindings()))<code>å¦‚æœè¿”å›æ˜¯falseçš„è¯ç›´æ¥è¿”å›ï¼Œå¦åˆ™ç»§ç»­é€’å½’è§£æIFæ ‡ç­¾ä»¥ä¸‹çš„æ ‡ç­¾ï¼Œå¹¶ä¸”è¿”å›</code>true<code>ã€‚é‚£ç»§ç»­æ¥çœ‹</code>evaluator.evaluateBoolean` çš„æ–¹æ³• </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> ExpressionEvaluator &#123;  </div><div class="line">  <span class="keyword">public</span> <span class="built_in">boolean</span> evaluateBoolean(<span class="built_in">String</span> expression, <span class="built_in">Object</span> parameterObject) &#123;  </div><div class="line">    <span class="built_in">Object</span> value = OgnlCache.getValue(expression, parameterObject);  </div><div class="line">    <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">Boolean</span>) <span class="keyword">return</span> (<span class="built_in">Boolean</span>) value;  </div><div class="line">    <span class="keyword">if</span> (value <span class="keyword">instanceof</span> <span class="built_in">Number</span>) <span class="keyword">return</span> !<span class="keyword">new</span> BigDecimal(<span class="built_in">String</span>.valueOf(value)).equals(BigDecimal.ZERO);  </div><div class="line">    <span class="keyword">return</span> value != <span class="literal">null</span>;  </div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>å…³é”®ç‚¹å°±åœ¨äºè¿™é‡Œï¼Œåœ¨<code>OgnlCache.getValue</code>ä¸­è°ƒç”¨äº†<code>Ognl.getValue</code>ï¼Œçœ‹åˆ°è¿™é‡Œæç„¶å¤§æ‚Ÿï¼Œmybatisæ˜¯ä½¿ç”¨çš„OGNLè¡¨è¾¾å¼æ¥è¿›è¡Œè§£æçš„ï¼Œåœ¨OGNLçš„è¡¨è¾¾å¼ä¸­ï¼Œ<code>&#39;y&#39;</code>ä¼šè¢«è§£ææˆå­—ç¬¦ï¼Œå› ä¸ºjavaæ˜¯<strong>å¼ºç±»å‹</strong>çš„ï¼Œ<code>char</code> å’Œ ä¸€ä¸ª<code>String</code> ä¼šå¯¼è‡´ä¸ç­‰ã€‚æ‰€ä»¥<code>ifæ ‡ç­¾</code>ä¸­çš„sqlä¸ä¼šè¢«è§£æã€‚å…·ä½“çš„è¯·å‚ç…§ OGNL è¡¨è¾¾å¼çš„è¯­æ³•ã€‚åˆ°è¿™é‡Œï¼Œä¸Šé¢çš„é—®é¢˜ç»ˆäºè§£å†³äº†ï¼Œåªéœ€è¦æŠŠä»£ç ä¿®æ”¹æˆï¼š</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">if</span> test='<span class="class"><span class="keyword">type</span></span>==<span class="string">"y"</span>'&gt;  <span class="comment">//æ³¨æ„æ˜¯åŒå¼•å·ï¼Œä¸æ˜¯å•å¼•å·ï¼ï¼ï¼</span></div><div class="line">    <span class="keyword">and</span> status = <span class="number">0</span>   </div><div class="line">&lt;/<span class="keyword">if</span>&gt;</div></pre></td></tr></table></figure>
<p>å°±å¯ä»¥æ‰§è¡Œäº†ï¼Œè¿™æ ·<code>&quot;y&quot;</code>è§£æå‡ºæ¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸¤è€…ç›¸ç­‰ï¼ </p>
<p>é™„ä¸Šä½œè€…æºåœ°å€ï¼š<a href="http://cheng-xinwei.iteye.com/blog/2008200" target="_blank" rel="external">ç‚¹æˆ‘è¿›å…¥åŸä½œè€…åšå®¢</a></p>

	

	

</article>




	<article>
	
		<h1><a href="/2017/01/27/å‰ç«¯ä½¿ç”¨FormDataå®ç°ä¸Šä¼ æ–‡ä»¶/">å‰ç«¯ä½¿ç”¨FormDataå®ç°ä¸Šä¼ æ–‡ä»¶</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2017-01-27</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/å‰ç«¯/">å‰ç«¯</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/js/">js</a> <a class="article__tag-link" href="/tags/å‰ç«¯/">å‰ç«¯</a>
			</span>
		
	</div>

	

	
		<blockquote>
<p>åœºæ™¯: ç”¨æˆ·é€šè¿‡ç‚¹å‡»å›¾ç‰‡å¼¹å‡ºä¸Šä¼ æ–‡ä»¶çš„æ¡†æ¡†ï¼Œç„¶åé€‰æ‹©å°†è¦æ›¿æ¢çš„å›¾ç‰‡ï¼Œé€‰æ‹©åå®æ—¶é¢„è§ˆï¼Œç‚¹å‡»ç¡®å®šåé€šè¿‡ajaxä¸Šä¼ åˆ°æœåŠ¡å™¨.</p>
</blockquote>
<p><strong>å‰ç«¯html</strong><br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"img_div"</span>&gt;</div><div class="line">    &lt;input type=<span class="string">"file"</span> <span class="built_in">id</span>=<span class="string">"img_upload"</span>&gt;</div><div class="line">    &lt;img <span class="built_in">id</span>=<span class="string">"picture"</span> src=<span class="string">"$picturePath$"</span> alt=<span class="string">"å¤´åƒ"</span> <span class="built_in">class</span>=<span class="string">"img-rounded"</span>&gt;</div><div class="line">&lt;/<span class="keyword">div</span>&gt;</div></pre></td></tr></table></figure></p>
<p><strong>å°†ä¸Šè¿°htmlä¸­çš„ä¸Šä¼ inputå…ƒç´ çš„é€æ˜åº¦è®¾ç½®ä¸º0ï¼Œå¹¶ä¸”è®¾ç½®å®½åº¦å’Œé«˜åº¦ï¼Œç”¨å®ƒæ¥é®ä½aæ ‡ç­¾,æ³¨æ„è®¾ç½®å¤–éƒ¨divçš„position</strong><br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#img_div</span>&#123;</div><div class="line">    <span class="attribute">position</span>: relative;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#img_upload</span>&#123;</div><div class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">z-index</span>: <span class="number">9</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>JSä»£ç </strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ä¸ºå¤´åƒä¸Šä¼ è®¾ç½®å®æ—¶é¢„è§ˆç›‘å¬å™¨</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setOnchangeListener</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    $(<span class="string">"body"</span>).on(<span class="string">"change"</span>,<span class="string">"#img_upload"</span>,previewFile);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//å®æ—¶é¢„è§ˆä¸Šä¼ å›¾ç‰‡</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">previewFile</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> preview=$(<span class="string">"#picture"</span>);</div><div class="line">    <span class="keyword">var</span> file=$(<span class="string">"#img_upload"</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</div><div class="line">    <span class="keyword">var</span> reader=<span class="keyword">new</span> FileReader();</div><div class="line">    reader.addEventListener(<span class="string">"load"</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">       preview.prop(<span class="string">"src"</span>,reader.result);</div><div class="line">    &#125;,<span class="literal">false</span>);</div><div class="line">    <span class="keyword">if</span>(file)&#123;</div><div class="line">        reader.readAsDataURL(file);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//ä¸Šä¼ å›¾ç‰‡</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setPicture</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> file=$(<span class="string">"#img_upload"</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</div><div class="line">    <span class="keyword">if</span>(file==<span class="literal">null</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">var</span> formData=<span class="keyword">new</span> FormData();</div><div class="line">    formData.append(<span class="string">'file'</span>,file);</div><div class="line">    <span class="keyword">var</span> url=serverUrl+<span class="string">"uploadPic"</span>;</div><div class="line">    $.ajax(&#123;</div><div class="line">        <span class="attr">url</span>:url,</div><div class="line">        <span class="attr">type</span>:<span class="string">'POST'</span>,</div><div class="line">        <span class="attr">cache</span>:<span class="literal">false</span>,</div><div class="line">        <span class="attr">data</span>:formData,</div><div class="line">        <span class="attr">processData</span>:<span class="literal">false</span>,</div><div class="line">        <span class="attr">contentType</span>:<span class="literal">false</span>,</div><div class="line">        <span class="attr">xhrFields</span>: &#123;</div><div class="line">            <span class="attr">withCredentials</span>: <span class="literal">true</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">crossDomain</span>: <span class="literal">true</span>,</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>å…¶ä¸­</strong></p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">processData:</span><span class="literal">false</span>,</div><div class="line"><span class="string">contentType:</span><span class="literal">false</span>,</div></pre></td></tr></table></figure>
<p><strong>çš„è®¾ç½®éœ€è¦æ³¨æ„ã€‚</strong></p>
<p><strong>è¿™é‡Œåå°æˆ‘ç”¨çš„æ˜¯java webï¼ˆSpringMVCï¼‰å°±è´´ä¸€ä¸‹æ§åˆ¶å™¨æ¥æ”¶ä¸Šä¼ æ–‡ä»¶çš„ä»£ç </strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/uploadPic"</span>)</div><div class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span> <span class="function">Object  <span class="title">handleUploadPic</span><span class="params">(@RequestParam(<span class="string">"file"</span>)</span>MultipartFile file, HttpServletRequest request)</span>&#123;</div><div class="line">        String userName=cookieService.getUserName(request);</div><div class="line">        String picUrl=fileService.saveImg(file);</div><div class="line">        String oldPicUrl=manageService.getPicUrl(userName);</div><div class="line">        fileService.deleteFile(oldPicUrl);</div><div class="line">        manageService.setPicUrl(userName,picUrl);</div><div class="line">        Map&lt;String,Object&gt; result=<span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">        result.put(keyStatus,valueStatusOk);</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line"></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>å…¶ä¸­fileå°±æ˜¯æ¥æ”¶åˆ°çš„ä¸Šä¼ æ–‡ä»¶</strong></p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/07/18/WebSocketä»‹ç»/">WebSocketä»‹ç»</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-07-18</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç½‘ç»œåè®®/">ç½‘ç»œåè®®</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/WebSocket/">WebSocket</a>
			</span>
		
	</div>

	

	
		<p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹HTTPè¿™ç§éæŒä¹…çš„åè®®çš„ä¸€äº›ç‰¹ç‚¹     </p>
<ul>
<li>HTTPçš„ç”Ÿå‘½å‘¨æœŸé€šè¿‡Requestæ¥ç•Œå®šï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªRequest ä¸€ä¸ªResponseï¼Œé‚£ä¹ˆåœ¨HTTP1.0ä¸­ï¼Œè¿™æ¬¡HTTPè¯·æ±‚å°±ç»“æŸäº†ã€‚   </li>
<li>åœ¨HTTP1.1ä¸­è¿›è¡Œäº†æ”¹è¿›ï¼Œä½¿å¾—æœ‰ä¸€ä¸ªkeep-aliveï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªHTTPè¿æ¥ä¸­ï¼Œå¯ä»¥å‘é€å¤šä¸ªRequestï¼Œæ¥æ”¶å¤šä¸ªResponseã€‚     </li>
<li>ä½†æ˜¯ä¸€ä¸ªrequeståªèƒ½æœ‰ä¸€ä¸ªresponseã€‚è€Œä¸”è¿™ä¸ªresponseä¹Ÿæ˜¯è¢«åŠ¨çš„ï¼Œä¸èƒ½ä¸»åŠ¨å‘èµ·ã€‚      </li>
</ul>
<p>åœ¨WebSocketè¿˜æ²¡å‡ºç°ä¹‹å‰æœ‰ä»¥ä¸‹å®ç°é•¿è¿æ¥çš„æ–¹å¼    </p>
<h3 id="ajaxè½®è¯¢"><a href="#ajaxè½®è¯¢" class="headerlink" title="ajaxè½®è¯¢"></a>ajaxè½®è¯¢</h3><p>ajaxè½®è¯¢ çš„åŸç†éå¸¸ç®€å•ï¼Œè®©æµè§ˆå™¨éš”ä¸ªå‡ ç§’å°±å‘é€ä¸€æ¬¡è¯·æ±‚ï¼Œè¯¢é—®æœåŠ¡å™¨æ˜¯å¦æœ‰æ–°ä¿¡æ¯ã€‚<br>è¿™ç§æ–¹å¼éœ€è¦æœåŠ¡å™¨æœ‰å¾ˆå¿«çš„å¤„ç†é€Ÿåº¦å’Œèµ„æºã€‚     </p>
<h3 id="long-poll"><a href="#long-poll" class="headerlink" title="long poll"></a>long poll</h3><p>long poll å…¶å®åŸç†è·Ÿ ajaxè½®è¯¢ å·®ä¸å¤šï¼Œéƒ½æ˜¯é‡‡ç”¨è½®è¯¢çš„æ–¹å¼ï¼Œä¸è¿‡é‡‡å–çš„æ˜¯é˜»å¡æ¨¡å‹ï¼ˆä¸€ç›´æ‰“ç”µè¯ï¼Œæ²¡æ”¶åˆ°å°±ä¸æŒ‚ç”µè¯ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®¢æˆ·ç«¯å‘èµ·è¿æ¥åï¼Œå¦‚æœæ²¡æ¶ˆæ¯ï¼Œå°±ä¸€ç›´ä¸è¿”å›Responseç»™å®¢æˆ·ç«¯ã€‚ç›´åˆ°æœ‰æ¶ˆæ¯æ‰è¿”å›ï¼Œè¿”å›å®Œä¹‹åï¼Œå®¢æˆ·ç«¯å†æ¬¡å»ºç«‹è¿æ¥ï¼Œå‘¨è€Œå¤å§‹ã€‚<br>è¿™ç§æ–¹å¼éœ€è¦æœåŠ¡ç«¯æœ‰å¾ˆé«˜çš„å¹¶å‘ï¼Œä¹Ÿå°±æ˜¯è¯´åŒæ—¶æ¥å¾…å®¢æˆ·çš„èƒ½åŠ›ã€‚     </p>
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºå…¶å®è¿™ä¸¤ç§æ–¹å¼ï¼Œéƒ½æ˜¯åœ¨ä¸æ–­åœ°å»ºç«‹HTTPè¿æ¥ï¼Œç„¶åç­‰å¾…æœåŠ¡ç«¯å¤„ç†ï¼Œå¯ä»¥ä½“ç°HTTPåè®®çš„å¦å¤–ä¸€ä¸ªç‰¹ç‚¹ï¼Œè¢«åŠ¨æ€§ã€‚ä½•ä¸ºè¢«åŠ¨æ€§å‘¢ï¼Œå…¶å®å°±æ˜¯ï¼ŒæœåŠ¡ç«¯ä¸èƒ½ä¸»åŠ¨è”ç³»å®¢æˆ·ç«¯ï¼Œåªèƒ½æœ‰å®¢æˆ·ç«¯å‘èµ·ã€‚       </p>
<h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><p>WebSocketåè®®æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäºTCPçš„åè®®ï¼Œå®ƒç”±é€šä¿¡åè®®å’Œç¼–ç¨‹APIç»„æˆï¼ŒWebSocketèƒ½å¤Ÿåœ¨æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹åŒå‘è¿æ¥ï¼Œä»¥åŸºäºäº‹ä»¶çš„æ–¹å¼ï¼Œèµ‹äºˆæµè§ˆå™¨å®æ—¶é€šä¿¡èƒ½åŠ›ã€‚æ—¢ç„¶æ˜¯åŒå‘é€šä¿¡ï¼Œå°±æ„å‘³ç€æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å‘é€å¹¶å“åº”è¯·æ±‚ï¼Œè€Œä¸å†åƒHTTPçš„è¯·æ±‚å’Œå“åº”ï¼Œè§£å†³äº†ä¸Šé¢åŒæ­¥æœ‰å»¶è¿Ÿï¼Œè€Œä¸”è¿˜éå¸¸æ¶ˆè€—èµ„æºçš„è¿™ç§æƒ…å†µã€‚   </p>

	

	

</article>




	<article>
	
		<h1><a href="/2016/02/23/WebSocketæ•°æ®ç¼–ç /">WebSocketæ•°æ®ç¼–ç </a></h1>
	
	<div class="article__infos">
		<span class="article__date">2016-02-23</span><br />
		
			<span class="article__category">
				<a class="article-category-link" href="/categories/ç½‘ç»œåè®®/">ç½‘ç»œåè®®</a>
			</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/WebSocket/">WebSocket</a>
			</span>
		
	</div>

	

	
		<p>WebSocketä¼ è¾“çš„æ•°æ®éƒ½æ˜¯ä»¥Frameï¼ˆå¸§ï¼‰çš„å½¢å¼å®ç°çš„ï¼Œå°±åƒTCP/UDPåè®®ä¸­çš„æŠ¥æ–‡æ®µSegmentã€‚ä¸‹é¢å°±æ˜¯ä¸€ä¸ªFrameï¼šï¼ˆä»¥bitä¸ºå•ä½è¡¨ç¤ºï¼‰   </p>
<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-------+-+-------------+-------------------------------+
|F|R|R|R| opcode|M| Payload len |    Extended payload length    |
|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
|N|V|V|V|       |S|             |   (if payload len==126/127)   |
| |1|2|3|       |K|             |                               |
+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
|     Extended payload length continued, if payload len == 127  |
+ - - - - - - - - - - - - - - - +-------------------------------+
|                               |Masking-key, if MASK set to 1  |
+-------------------------------+-------------------------------+
| Masking-key (continued)       |          Payload Data         |
+-------------------------------- - - - - - - - - - - - - - - - +
:                     Payload Data continued ...                :
+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
|                     Payload Data continued ...                |
+---------------------------------------------------------------+
</code></pre><h3 id="å„å­—æ®µè§£é‡Š"><a href="#å„å­—æ®µè§£é‡Š" class="headerlink" title="å„å­—æ®µè§£é‡Š"></a>å„å­—æ®µè§£é‡Š</h3><h4 id="FINï¼š1-bit"><a href="#FINï¼š1-bit" class="headerlink" title="FINï¼š1 bit"></a>FINï¼š1 bit</h4><p>è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæ¶ˆæ¯çš„æœ€åçš„ä¸€å¸§ã€‚ç¬¬ä¸€ä¸ªå¸§ä¹Ÿå¯èƒ½æ˜¯æœ€åä¸€ä¸ªã€‚    </p>
<ul>
<li>0 : è¿˜æœ‰åç»­å¸§     </li>
<li>1 : æœ€åä¸€å¸§    </li>
</ul>
<h4 id="RSV1ã€2ã€3ï¼š-1-bit-each"><a href="#RSV1ã€2ã€3ï¼š-1-bit-each" class="headerlink" title="RSV1ã€2ã€3ï¼š 1 bit each"></a>RSV1ã€2ã€3ï¼š 1 bit each</h4><p>é™¤éä¸€ä¸ªæ‰©å±•ç»è¿‡åå•†èµ‹äºˆäº†éé›¶å€¼ä»¥æŸç§å«ä¹‰ï¼Œå¦åˆ™å¿…é¡»ä¸º0<br>å¦‚æœæ²¡æœ‰å®šä¹‰éé›¶å€¼ï¼Œå¹¶ä¸”æ”¶åˆ°äº†éé›¶çš„RSVï¼Œåˆ™websocketé“¾æ¥ä¼šå¤±è´¥    </p>
<h4 id="Opcodeï¼š-4-bit"><a href="#Opcodeï¼š-4-bit" class="headerlink" title="Opcodeï¼š 4 bit"></a>Opcodeï¼š 4 bit</h4><p>è§£é‡Šè¯´æ˜ â€œPayload dataâ€ çš„ç”¨é€”/åŠŸèƒ½<br>å¦‚æœæ”¶åˆ°äº†æœªçŸ¥çš„opcodeï¼Œæœ€åä¼šæ–­å¼€é“¾æ¥<br>å®šä¹‰äº†ä»¥ä¸‹å‡ ä¸ªopcodeå€¼:   </p>
<ul>
<li>0 : ä»£è¡¨è¿ç»­çš„å¸§   </li>
<li>1 : textå¸§   </li>
<li>2 ï¼š binaryå¸§      </li>
<li>3-7 ï¼š ä¸ºéæ§åˆ¶å¸§è€Œé¢„ç•™çš„     </li>
<li>8 ï¼š å…³é—­æ¡æ‰‹å¸§    </li>
<li>9 ï¼š pingå¸§    </li>
<li>A :  pongå¸§      </li>
<li>B-F ï¼š ä¸ºéæ§åˆ¶å¸§è€Œé¢„ç•™çš„     </li>
</ul>
<h4 id="Maskï¼š-1-bit"><a href="#Maskï¼š-1-bit" class="headerlink" title="Maskï¼š 1 bit"></a>Maskï¼š 1 bit</h4><p>å®šä¹‰â€œpayload dataâ€æ˜¯å¦è¢«æ·»åŠ æ©ç <br>å¦‚æœç½®1ï¼Œ â€œMasking-keyâ€å°±ä¼šè¢«èµ‹å€¼<br><strong>æ‰€æœ‰ä»å®¢æˆ·ç«¯å‘å¾€æœåŠ¡å™¨çš„å¸§éƒ½ä¼šè¢«ç½®1</strong>        </p>
<h4 id="Payload-lengthï¼š-7-bit-7-16-bit-7-64-bit"><a href="#Payload-lengthï¼š-7-bit-7-16-bit-7-64-bit" class="headerlink" title="Payload lengthï¼š 7 bit | 7+16 bit | 7+64 bit"></a>Payload lengthï¼š 7 bit | 7+16 bit | 7+64 bit</h4><ul>
<li>payload data çš„é•¿åº¦å¦‚æœåœ¨0~125 bytesèŒƒå›´å†…ï¼Œå®ƒå°±æ˜¯payload lengthï¼Œ  </li>
<li>å¦‚æœæ˜¯126ï¼Œ ç´§éšå…¶åçš„è¢«è¡¨ç¤ºä¸º16 bitsçš„2 bytesæ— ç¬¦å·æ•´å‹å°±æ˜¯payload lengthï¼Œ     </li>
<li>å¦‚æœæ˜¯127ï¼Œ ç´§éšå…¶åçš„è¢«è¡¨ç¤ºä¸º64 bitsçš„8 bytesæ— ç¬¦å·æ•´å‹å°±æ˜¯payload length   </li>
</ul>
<h4 id="Masking-keyï¼š-0-or-4-bytes"><a href="#Masking-keyï¼š-0-or-4-bytes" class="headerlink" title="Masking-keyï¼š 0 or 4 bytes"></a>Masking-keyï¼š 0 or 4 bytes</h4><p>æ‰€æœ‰ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨çš„å¸§éƒ½åŒ…å«ä¸€ä¸ª32 bitsçš„æ©ç ï¼ˆå¦‚æœâ€œmask bitâ€è¢«è®¾ç½®æˆ1ï¼‰ï¼Œå¦åˆ™ä¸º0 bitã€‚<br>ä¸€æ—¦æ©ç è¢«è®¾ç½®ï¼Œæ‰€æœ‰æ¥æ”¶åˆ°çš„payload dataéƒ½å¿…é¡»ä¸è¯¥å€¼ä»¥ä¸€ç§ç®—æ³•åšå¼‚æˆ–è¿ç®—æ¥è·å–çœŸå®å€¼ã€‚   </p>
<h4 id="Payload-data-x-y-bytes"><a href="#Payload-data-x-y-bytes" class="headerlink" title="Payload data: (x+y) bytes"></a>Payload data: (x+y) bytes</h4><p>å®ƒæ˜¯â€Extension dataâ€å’Œâ€Application dataâ€çš„æ€»å’Œï¼Œä¸€èˆ¬æ‰©å±•æ•°æ®ä¸ºç©ºã€‚</p>
<h4 id="Extension-data-x-bytes"><a href="#Extension-data-x-bytes" class="headerlink" title="Extension data: x bytes"></a>Extension data: x bytes</h4><ul>
<li>é™¤éæ‰©å±•è¢«å®šä¹‰ï¼Œå¦åˆ™å°±æ˜¯0   </li>
<li>ä»»ä½•æ‰©å±•å¿…é¡»æŒ‡å®šå…¶Extension dataçš„é•¿åº¦   </li>
</ul>
<h4 id="Application-data-y-bytes"><a href="#Application-data-y-bytes" class="headerlink" title="Application data: y bytes"></a>Application data: y bytes</h4><p>å æ®â€Extension dataâ€ä¹‹åçš„å‰©ä½™å¸§çš„ç©ºé—´   </p>
<h2 id="Masking"><a href="#Masking" class="headerlink" title="Masking"></a>Masking</h2><p>å½“maskå­—æ®µçš„å€¼ä¸º1æ—¶ï¼Œpayload-dataå­—æ®µçš„æ•°æ®éœ€è¦ç»è¿™ä¸ªæ©ç è¿›è¡Œè§£å¯†ã€‚   </p>
<ul>
<li>æœåŠ¡å™¨æ¨é€åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯ä¸­ï¼Œmaskå­—æ®µæ˜¯0,ä¹Ÿå°±æ˜¯è¯´Masking-keyä¸ºç©ºã€‚è¿™æ ·çš„è¯ï¼Œæ•°æ®çš„è§£æå°±ä¸æ¶‰åŠåˆ°æ©ç ï¼Œç›´æ¥ä½¿ç”¨å°±è¡Œã€‚    </li>
<li>å¦‚æœæ¶ˆæ¯æ˜¯ä»å®¢æˆ·ç«¯å‘é€åˆ°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆmaskä¸€å®šæ˜¯1,Masking-keyä¸€å®šæ˜¯ä¸€ä¸ª32bitçš„å€¼ã€‚    </li>
</ul>
<p>ä¸‹é¢ä¸ºmaskä¸º1çš„ä¸€ä¸ªä¾‹å­   </p>
<p>å½“è¯»å–åˆ°payload-dataæ—¶ï¼Œé¦–å…ˆå°†æ•°æ®æŒ‰byteä¾æ¬¡ä¸Masking-keyä¸­çš„4ä¸ªbyteæŒ‰ç…§å¦‚ä¸‹ç®—æ³•åšå¼‚æˆ–ã€‚    </p>
<pre><code class="java"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">maskPayload</span><span class="params">(<span class="keyword">byte</span>[] payload)</span> </span>{
   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;payload.length;i++){
        payload[i]^=mask[i%<span class="number">4</span>];
    }
}
</code></pre>
<h2 id="å¸§çš„ç±»åˆ«"><a href="#å¸§çš„ç±»åˆ«" class="headerlink" title="å¸§çš„ç±»åˆ«"></a>å¸§çš„ç±»åˆ«</h2><h3 id="æ§åˆ¶å¸§"><a href="#æ§åˆ¶å¸§" class="headerlink" title="æ§åˆ¶å¸§"></a>æ§åˆ¶å¸§</h3><ul>
<li>æ§åˆ¶å¸§ç”¨æ¥è¯´æ˜WebSocketçš„çŠ¶æ€ä¿¡æ¯ï¼Œç”¨æ¥æ§åˆ¶åˆ†ç‰‡ã€è¿æ¥çš„å…³é—­ç­‰ç­‰ã€‚æ‰€æœ‰çš„æ§åˆ¶å¸§å¿…é¡»æœ‰ä¸€ä¸ªå°äºç­‰äº125å­—èŠ‚çš„payloadï¼Œå¹¶ä¸”control Framesä¸å…è®¸è¢«åˆ†ç‰‡ã€‚     </li>
<li>Opcodeä¸º0x0ï¼ˆæŒç»­çš„å¸§ï¼‰ï¼Œ0x8ï¼ˆå…³é—­è¿æ¥ï¼‰ï¼Œ0x9ï¼ˆPingå¸§ï¼‰å’Œ0xAï¼ˆPongå¸§ï¼‰ä»£è¡¨æ§åˆ¶å¸§     </li>
</ul>
<h3 id="æ•°æ®å¸§"><a href="#æ•°æ®å¸§" class="headerlink" title="æ•°æ®å¸§"></a>æ•°æ®å¸§</h3><p>å‰é¢æˆ‘ä»¬æ€»æ˜¯è°ˆåˆ°â€œæ§åˆ¶å¸§â€å’Œâ€œéæ§åˆ¶å¸§â€ï¼Œæƒ³å¿…å¤§å®¶å·²ç¶“çœ‹å‡ºæ¥ä¸€äº›é—¨è·¯ã€‚å…¶å®æ•°æ®å¸§å°±æ˜¯éæ§åˆ¶å¸§ã€‚å› ä¸ºè¿™ä¸ªå¸§å¹¶ä¸æ˜¯ç”¨æ¥æä¾›åè®®è¿æ¥çŠ¶æ€ä¿¡æ¯çš„ã€‚<br>æ•°æ®å¸§ç”±æœ€é«˜ç¬¦å·ä½æ˜¯0çš„Opcodeç¡®å®šï¼Œç°åœ¨å¯ç”¨çš„å‡ ä¸ªæ•°æ®å¸§çš„Opcodeæ˜¯0x1ï¼ˆutf-8æ–‡æœ¬ï¼‰ã€0x2ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ã€‚      </p>
<h2 id="åˆ†ç‰‡ï¼ˆFragmentï¼‰"><a href="#åˆ†ç‰‡ï¼ˆFragmentï¼‰" class="headerlink" title="åˆ†ç‰‡ï¼ˆFragmentï¼‰"></a>åˆ†ç‰‡ï¼ˆFragmentï¼‰</h2><p>ç†è®ºä¸Šæ¥è¯´ï¼Œæ¯ä¸ªå¸§ï¼ˆFrameï¼‰çš„å¤§å°æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œå› ä¸ºpayload-dataåœ¨æ•´ä¸ªå¸§çš„æœ€åã€‚ä½†æ˜¯å‘é€çš„æ•°æ®æœ‰ä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™ WebSocket å¾ˆå¯èƒ½æ— æ³•é«˜æ•ˆçš„åˆ©ç”¨ç½‘ç»œå¸¦å®½ã€‚é‚£å¦‚æœæˆ‘ä»¬æƒ³ä¼ ç‚¹å¤§æ•°æ®è¯¥æ€ä¹ˆåŠå‘¢ï¼ŸWebSocketåè®®ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–¹æ³•ï¼šåˆ†ç‰‡ï¼Œå°†åŸæœ¬ä¸€ä¸ªå¤§çš„å¸§æ‹†åˆ†æˆæ•°ä¸ªå°çš„å¸§ã€‚ä¸‹é¢æ˜¯æŠŠä¸€ä¸ªå¤§çš„Frameåˆ†ç‰‡çš„å›¾ç¤ºï¼š   </p>
<blockquote>
<p> ç¼–å·ï¼š      0  1  â€¦.  n-2 n-1<br>  åˆ†ç‰‡ï¼š     |â€”â€”|â€”â€”|â€¦â€¦|â€”â€”|â€”â€”|<br>  FINï¼š      0  0  â€¦.   0  1<br>  Opcodeï¼š   !0 0  â€¦.   0  0   </p>
</blockquote>
<p>ç”±å›¾å¯çŸ¥ï¼Œ    </p>
<ul>
<li>ç¬¬ä¸€ä¸ªåˆ†ç‰‡çš„FINä¸º0ï¼ŒOpcodeä¸ºé0å€¼ï¼ˆ0x1æˆ–0x2ï¼‰   </li>
<li>æœ€åä¸€ä¸ªåˆ†ç‰‡çš„FINä¸º1ï¼ŒOpcodeä¸º0    </li>
<li>ä¸­é—´åˆ†ç‰‡çš„FINå’ŒOpcodeäºŒè€…å‡ä¸º0     </li>
</ul>
<h2 id="å…³é—­è¿æ¥"><a href="#å…³é—­è¿æ¥" class="headerlink" title="å…³é—­è¿æ¥"></a>å…³é—­è¿æ¥</h2><p>æ­£å¸¸çš„è¿æ¥å…³é—­æµç¨‹   </p>
<ol>
<li>å‘é€å…³é—­è¿æ¥è¯·æ±‚ï¼ˆClose Handshakeï¼‰<br>å³å‘é€Close Frameï¼ˆOpcodeä¸º0x8ï¼‰ã€‚ä¸€æ—¦ä¸€ç«¯å‘é€/æ¥æ”¶äº†ä¸€ä¸ªClose Frameï¼Œå°±å¼€å§‹äº†Close Handshakeï¼Œå¹¶ä¸”è¿æ¥çŠ¶æ€å˜ä¸ºClosingã€‚   </li>
<li>Close Frameä¸­å¦‚æœåŒ…å«Payload dataï¼Œåˆ™dataçš„å‰2å­—èŠ‚å¿…é¡»ä¸ºä¸¤å­—èŠ‚çš„æ— ç¬¦å·æ•´å½¢ï¼Œï¼ˆåŒæ ·éµå¾ªç½‘ç»œå­—èŠ‚åºï¼šBEï¼‰ç”¨äºè¡¨ç¤ºçŠ¶æ€ç ï¼Œå¦‚æœ2byteä¹‹åä»æœ‰å†…å®¹ï¼Œåˆ™åº”åŒ…å«utf-8ç¼–ç çš„å…³é—­ç†ç”±ã€‚     </li>
<li>å¦‚æœä¸€ç«¯åœ¨ä¹‹å‰æœªå‘é€è¿‡Close Frameï¼Œåˆ™å½“ä»–æ”¶åˆ°ä¸€ä¸ªClose Frameæ—¶ï¼Œå¿…é¡»å›å¤ä¸€ä¸ªClose Frameã€‚ä½†å¦‚æœå®ƒæ­£åœ¨å‘é€æ•°æ®ï¼Œåˆ™å¯ä»¥æ¨è¿Ÿåˆ°å½“å‰æ•°æ®å‘é€å®Œï¼Œå†å‘é€Close Frameã€‚æ¯”å¦‚Close Frameåœ¨åˆ†ç‰‡å‘é€æ—¶åˆ°è¾¾ï¼Œåˆ™è¦ç­‰åˆ°æ‰€æœ‰å‰©ä½™åˆ†ç‰‡å‘é€å®Œä¹‹åï¼Œæ‰å¯ä»¥ä½œå‡ºå›å¤ã€‚   </li>
<li>å…³é—­WebSocketè¿æ¥   </li>
<li>å½“ä¸€ç«¯å·²ç»æ”¶åˆ°Close Frameï¼Œå¹¶å·²å‘é€äº†Close Frameæ—¶ï¼Œå°±å¯ä»¥å…³é—­è¿æ¥äº†ï¼Œclose handshakeè¿‡ç¨‹ç»“æŸã€‚è¿™æ—¶ä¸¢å¼ƒæ‰€æœ‰å·²ç»æ¥æ”¶åˆ°çš„æœ«å°¾å­—èŠ‚ã€‚   </li>
<li>å…³é—­TCPè¿æ¥   </li>
<li>å½“åº•å±‚TCPè¿æ¥å…³é—­æ—¶ï¼Œè¿æ¥çŠ¶æ€å˜ä¸ºClosedã€‚     </li>
</ol>
<h3 id="clean-closed"><a href="#clean-closed" class="headerlink" title="clean closed"></a>clean closed</h3><ul>
<li>å¦‚æœTCPè¿æ¥åœ¨Close handshakeå®Œæˆä¹‹åå…³é—­ï¼Œå°±è¡¨ç¤ºWebSocketè¿æ¥å·²ç»clean closedï¼ˆå½»åº•å…³é—­ï¼‰äº†ã€‚   </li>
<li>å¦‚æœWebSocketè¿æ¥å¹¶æœªæˆåŠŸå»ºç«‹ï¼ŒçŠ¶æ€ä¹Ÿä¸ºè¿æ¥å·²å…³é—­ï¼Œä½†å¹¶ä¸æ˜¯clean closedã€‚   </li>
</ul>
<h3 id="æ­£å¸¸å…³é—­"><a href="#æ­£å¸¸å…³é—­" class="headerlink" title="æ­£å¸¸å…³é—­"></a>æ­£å¸¸å…³é—­</h3><p>æ­£å¸¸å…³é—­è¿‡ç¨‹å±äºclean closeï¼Œåº”å½“åŒ…å«close handshakeã€‚  </p>
<p>é€šå¸¸æ¥è®²ï¼Œåº”è¯¥ç”±æœåŠ¡å™¨å…³é—­åº•å±‚TCPè¿æ¥ï¼Œè€Œå®¢æˆ·ç«¯åº”è¯¥ç­‰å¾…æœåŠ¡å™¨å…³é—­è¿æ¥ï¼Œé™¤éç­‰å¾…è¶…æ—¶çš„è¯ï¼Œé‚£ä¹ˆè‡ªå·±å…³é—­åº•å±‚TCPè¿æ¥ã€‚    </p>
<h3 id="å¼‚å¸¸å…³é—­"><a href="#å¼‚å¸¸å…³é—­" class="headerlink" title="å¼‚å¸¸å…³é—­"></a>å¼‚å¸¸å…³é—­</h3><p>ç”±äºæŸç§ç®—æ³•æˆ–è§„å®šï¼Œä¸€ç«¯ç›´æ¥å…³é—­è¿æ¥ã€‚ï¼ˆç‰¹æŒ‡åœ¨open handshakeï¼ˆæ‰“å¼€è¿æ¥ï¼‰é˜¶æ®µï¼‰<br>åº•å±‚è¿æ¥ä¸¢å¤±å¯¼è‡´çš„è¿æ¥ä¸­æ–­ã€‚ </p>
<h3 id="è¿æ¥å¤±è´¥"><a href="#è¿æ¥å¤±è´¥" class="headerlink" title="è¿æ¥å¤±è´¥"></a>è¿æ¥å¤±è´¥</h3><p>ç”±äºæŸç§ç®—æ³•æˆ–è§„èŒƒè¦æ±‚æŒ‡å®šè¿æ¥å¤±è´¥ã€‚è¿™æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¿…é¡»å…³é—­WebSocketè¿æ¥ã€‚å½“ä¸€ç«¯å¾—çŸ¥è¿æ¥å¤±è´¥æ—¶ï¼Œä¸å‡†å†å¤„ç†æ•°æ®ï¼ŒåŒ…æ‹¬å“åº”close frameã€‚     </p>

	

	

</article>






	<span class="different-posts">ğŸ“• end of posts ğŸ“•</span>


	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>Hi there, <br />welcome to my Blog glad you found it. Have a look around, will you?</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2017 Wenyuan Chen | Powered by <a href="https://hexo.io/">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
